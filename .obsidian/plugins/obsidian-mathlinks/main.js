/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MathLinks
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// src/settings.ts
var import_obsidian = require("obsidian");

// src/utils.ts
function formatToRegex(str) {
  return str.replace(/\s/g, "\\s").replace(/\./g, "\\.").replace(/\(/g, "\\(").replace(/\)/g, "\\)").replace(/\{/g, "\\{").replace(/\}/g, "\\}").replace(/\[/g, "\\[").replace(/\]/g, "\\]");
}

// src/settings.ts
var MathLinksSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    return __async(this, null, function* () {
      const { containerEl } = this;
      containerEl.empty();
      containerEl.createEl("h2", { text: "MathLinks Settings" });
      new import_obsidian.Setting(containerEl).setName("Add a new template").setDesc(createFragment((e) => {
        e.createSpan({
          text: "Automatically generate a mathLink with templates. Use "
        });
        e.createEl("code", {
          text: "mathLink: auto"
        });
        e.createSpan({
          text: " to use templates in a file."
        });
      })).addButton((button) => {
        let b = button.setTooltip("Add").setIcon("plus").onClick(() => __async(this, null, function* () {
          let modal = new AddTemplatesModal(this.app);
          modal.onClose = () => __async(this, null, function* () {
            if (modal.saved) {
              const template = {
                title: modal.title,
                replaced: modal.replaced,
                replacement: modal.replacement,
                globalMatch: modal.globalMatch,
                sensitive: modal.sensitive,
                word: modal.word
              };
              this.plugin.settings.templates.push(template);
              yield this.plugin.saveSettings();
              new import_obsidian.Notice("MathLinks: Template added.");
            }
          });
          modal.open();
          this.display();
        }));
        return b;
      });
      let templateTitleToEdit;
      new import_obsidian.Setting(containerEl).setName("Edit template").setDesc("Select a template to edit it.").addDropdown((dropdown) => {
        dropdown.addOption("__select", "Select");
        for (let i = 0; i < this.plugin.settings.templates.length; i++) {
          dropdown.addOption(this.plugin.settings.templates[i].title, this.plugin.settings.templates[i].title);
        }
        dropdown.onChange((current) => __async(this, null, function* () {
          if (current != "__select")
            templateTitleToEdit = current;
          else
            templateTitleToEdit = null;
        }));
      }).addExtraButton((button) => {
        let b = button.setTooltip("Edit").setIcon("edit").onClick(() => __async(this, null, function* () {
          if (templateTitleToEdit) {
            let originalTemplates = JSON.parse(JSON.stringify(this.plugin.settings.templates));
            let modal = new EditTemplatesModal(this.app, templateTitleToEdit, this.plugin.settings.templates);
            modal.onClose = () => __async(this, null, function* () {
              if (modal.saved) {
                yield this.plugin.saveSettings();
                new import_obsidian.Notice("MathLinks: Template saved.");
              } else {
                this.plugin.settings.templates = originalTemplates;
              }
            });
            modal.open();
            this.display();
          } else {
            new import_obsidian.Notice("MathLinks: Please select a template.");
          }
        }));
        return b;
      });
      let templateTitleToDelete;
      new import_obsidian.Setting(containerEl).setName("Delete a template").setDesc("Select a template to delete it.").addDropdown((dropdown) => {
        dropdown.addOption("__select", "Select");
        for (let i = 0; i < this.plugin.settings.templates.length; i++) {
          dropdown.addOption(this.plugin.settings.templates[i].title, this.plugin.settings.templates[i].title);
        }
        dropdown.onChange((current) => __async(this, null, function* () {
          if (current != "__select")
            templateTitleToDelete = current;
          else
            templateTitleToDelete = null;
        }));
      }).addExtraButton((button) => {
        let b = button.setTooltip("Delete").setIcon("trash").onClick(() => __async(this, null, function* () {
          if (templateTitleToDelete) {
            let modal = new DeleteTemplatesModal(this.app, templateTitleToDelete);
            modal.onClose = () => __async(this, null, function* () {
              if (modal.proceed) {
                for (let i = 0; i < this.plugin.settings.templates.length; i++) {
                  if (this.plugin.settings.templates[i].title === templateTitleToDelete) {
                    this.plugin.settings.templates.splice(i, 1);
                    yield this.plugin.saveSettings();
                    new import_obsidian.Notice(`MathLinks: Template '${templateTitleToDelete}' deleted.`);
                    break;
                  }
                }
              }
            });
            modal.open();
            this.display();
          } else {
            new import_obsidian.Notice("MathLinks: Please select a template.");
          }
        }));
        return b;
      });
    });
  }
};
var AddTemplatesModal = class extends import_obsidian.Modal {
  constructor(app) {
    super(app);
    this.saved = false;
    this.title = "";
    this.replaced = "";
    this.replacement = "";
    this.globalMatch = true;
    this.sensitive = true;
    this.word = true;
  }
  onOpen() {
    const { contentEl } = this;
    let titleText;
    new import_obsidian.Setting(contentEl).setName("Title").setDesc("Name of the template.").addText((text) => {
      titleText = text;
      titleText.setValue(this.title).onChange((current) => {
        this.title = current;
      });
    });
    let replacedText;
    new import_obsidian.Setting(contentEl).setName("Replace all ...").setDesc("Strings to be matched and replaced.").addText((text) => {
      replacedText = text;
      replacedText.setValue(this.replaced).onChange((current) => {
        this.replaced = formatToRegex(current);
      });
    });
    let replacementText;
    new import_obsidian.Setting(contentEl).setName("... with").setDesc("String to replace all matches. Do not escape backslashes.").addText((text) => {
      replacementText = text;
      replacementText.setValue(this.replacement).onChange((current) => {
        this.replacement = current;
      });
    });
    new import_obsidian.Setting(contentEl).setName("Global").setDesc("Match all instances (instead of just the first).").addToggle((toggle) => {
      toggle.setValue(true).onChange((current) => this.globalMatch = current);
    });
    new import_obsidian.Setting(contentEl).setName("Case sensitive").setDesc("Matches will be case sensitive.").addToggle((toggle) => {
      toggle.setValue(true).onChange((current) => this.sensitive = current);
    });
    new import_obsidian.Setting(contentEl).setName("Whole word").setDesc("Only match whole words.").addToggle((toggle) => {
      toggle.setValue(true).onChange((current) => this.word = current);
    });
    let footerEl = contentEl.createDiv();
    let footerButtons = new import_obsidian.Setting(footerEl);
    footerButtons.addButton((b) => {
      b.setTooltip("Save").setIcon("checkmark").onClick(() => __async(this, null, function* () {
        this.saved = true;
        this.close();
      }));
      return b;
    });
    footerButtons.addExtraButton((b) => {
      b.setTooltip("Cancel").setIcon("cross").onClick(() => {
        this.saved = false;
        this.close();
      });
      return b;
    });
  }
};
var EditTemplatesModal = class extends import_obsidian.Modal {
  constructor(app, templateTitle, templates) {
    super(app);
    this.saved = false;
    this.templateTitle = templateTitle;
    this.templates = templates;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    for (let i = 0; i < this.templates.length; i++) {
      if (this.templateTitle != void 0 && this.templates[i].title === this.templateTitle) {
        let titleText;
        new import_obsidian.Setting(contentEl).setName("Title").setDesc("Name of the template.").addText((text) => {
          titleText = text;
          titleText.setValue(this.templates[i].title).onChange((current) => {
            this.templates[i].title = current;
          });
        });
        let replacedText;
        new import_obsidian.Setting(contentEl).setName("Replace all ...").setDesc("Strings to be matched and replaced.").addText((text) => {
          replacedText = text;
          replacedText.setValue(this.templates[i].replaced).onChange((current) => {
            this.templates[i].replaced = current;
          });
        });
        let replacementText;
        new import_obsidian.Setting(contentEl).setName("... with").setDesc("String to replace all matches. Do not escape backslashes.").addText((text) => {
          replacementText = text;
          replacementText.setValue(this.templates[i].replacement).onChange((current) => {
            this.templates[i].replacement = current;
          });
        });
        new import_obsidian.Setting(contentEl).setName("Global").setDesc("Match all instances (instead of just the first)").addToggle((toggle) => {
          toggle.setValue(this.templates[i].globalMatch).onChange((current) => this.templates[i].globalMatch = current);
        });
        new import_obsidian.Setting(contentEl).setName("Case sensitive").setDesc("Matches will be case sensitive.").addToggle((toggle) => {
          toggle.setValue(this.templates[i].sensitive).onChange((current) => this.templates[i].sensitive = current);
        });
        new import_obsidian.Setting(contentEl).setName("Whole word").setDesc("Only match whole words.").addToggle((toggle) => {
          toggle.setValue(this.templates[i].sensitive).onChange((current) => this.templates[i].word = current);
        });
        break;
      }
    }
    let footerEl = contentEl.createDiv();
    let footerButtons = new import_obsidian.Setting(footerEl);
    footerButtons.addButton((b) => {
      b.setTooltip("Save").setIcon("checkmark").onClick(() => __async(this, null, function* () {
        this.saved = true;
        this.close();
      }));
      return b;
    });
    footerButtons.addExtraButton((b) => {
      b.setTooltip("Cancel").setIcon("cross").onClick(() => {
        this.saved = false;
        this.close();
      });
      return b;
    });
  }
};
var DeleteTemplatesModal = class extends import_obsidian.Modal {
  constructor(app, templateTitle) {
    super(app);
    this.proceed = false;
    this.templateTitle = templateTitle;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h3", { text: `Are you sure you want to delete '${this.templateTitle}'?` });
    let footerEl = contentEl.createDiv();
    let footerButtons = new import_obsidian.Setting(footerEl);
    footerButtons.addButton((b) => {
      b.setTooltip("Yes").setIcon("checkmark").onClick(() => __async(this, null, function* () {
        this.proceed = true;
        this.close();
      }));
      return b;
    });
    footerButtons.addExtraButton((b) => {
      b.setTooltip("Cancel").setIcon("cross").onClick(() => {
        this.proceed = false;
        this.close();
      });
      return b;
    });
  }
};

// src/main.ts
var DEFAULT_SETTINGS = {
  templates: []
};
var MathLinks = class extends import_obsidian2.Plugin {
  onload() {
    return __async(this, null, function* () {
      yield this.loadSettings();
      const settings = this.settings;
      const { vault } = this.app;
      const { workspace } = this.app;
      const { metadataCache } = this.app;
      const { fileManager } = this.app;
      metadataCache.on("changed", (file, data, cache) => __async(this, null, function* () {
        console.log(file.name);
        let mathLink = yield getMathLink(file);
        if (mathLink != null && mathLink != void 0) {
          let backLinkFilePaths = getBackLinkFilePaths(file);
          if (backLinkFilePaths.length != 0) {
            backLinkFilePaths.forEach((backLinkFilePath) => __async(this, null, function* () {
              let backLinkFile = vault.getAbstractFileByPath(backLinkFilePath);
              if (backLinkFile instanceof import_obsidian2.TFile) {
                let backLinkFileContent = yield vault.read(backLinkFile);
                let modified2 = convertToMathLinks(file.name, backLinkFileContent, mathLink[0]);
                if (backLinkFileContent != modified2) {
                  vault.modify(backLinkFile, modified2);
                }
              }
            }));
          }
        }
        let fileContent = yield vault.read(file);
        let modified = fileContent;
        if (cache.links != void 0) {
          cache.links.forEach((outLink) => __async(this, null, function* () {
            let outLinkFileName = outLink.link;
            if (outLink.displayText != "")
              outLinkFileName = outLinkFileName.replace(/$/, ".md");
            let outLinkFilePath = fileManager.getNewFileParent(outLinkFileName).path + "/" + outLinkFileName;
            let outLinkFile = vault.getAbstractFileByPath(outLinkFilePath);
            if (outLinkFile instanceof import_obsidian2.TFile) {
              let outLinkMathLink = yield getMathLink(outLinkFile);
              if (outLinkMathLink != null && outLinkMathLink != void 0) {
                modified = convertToMathLinks(outLinkFileName, modified, outLinkMathLink[0]);
                if (fileContent != modified) {
                  yield vault.modify(file, modified);
                }
              }
            }
          }));
        }
      }));
      function getMathLink(file) {
        return __async(this, null, function* () {
          let contents = yield vault.read(file);
          contents = contents.split(/\r?\n/);
          if (contents[0] === "---") {
            for (let lineNumber = 1; lineNumber < contents.length; lineNumber++) {
              let line = contents[lineNumber];
              if (line.length < 10) {
                lineNumber++;
              } else {
                let key = line.substring(0, 10);
                if (key === "mathLink: ") {
                  let value = line.replace(key, "");
                  if (value != "") {
                    if (value === "auto") {
                      let mathLink = yield generateMathLinkFromAuto(file);
                      return [mathLink, lineNumber];
                    }
                    return [value, lineNumber];
                  } else {
                    return [null, lineNumber];
                  }
                } else if (line === "---") {
                  return void 0;
                } else {
                  lineNumber++;
                }
              }
            }
          }
          return void 0;
        });
      }
      function getBackLinkFilePaths(file) {
        let backLinkFilePaths = [];
        Object.keys(metadataCache.resolvedLinks).forEach((key) => {
          let links = metadataCache.resolvedLinks[key];
          Object.keys(links).forEach((link) => {
            if (link === file.path) {
              backLinkFilePaths.push(key);
            }
          });
        });
        return backLinkFilePaths;
      }
      function generateMathLinkFromAuto(file) {
        return __async(this, null, function* () {
          let templates = settings.templates;
          let baseName = file.name.replace(".md", "");
          let mathLink = baseName;
          for (let i = 0; i < templates.length; i++) {
            let replaced = new RegExp(formatToRegex(templates[i].replaced));
            let replacement = templates[i].replacement;
            let flags = "";
            if (templates[i].globalMatch)
              flags += "g";
            if (!templates[i].sensitive)
              flags += "i";
            if (templates[i].word)
              replaced = RegExp(replaced.source.replace(/^/, "\\b").replace(/$/, "\\b"), flags);
            else
              replaced = RegExp(replaced.source, flags);
            mathLink = mathLink.replace(replaced, replacement);
          }
          return mathLink;
        });
      }
      function convertToMathLinks(fileName, fileContent, mathLink) {
        let left = mathLink.replace(/^/, "[").replace(/$/, "]");
        let right = fileName.replace(/^/, "(").replace(/$/, ")").replace(/\s/g, "%20");
        let newLink = `${left}${right}`;
        let mixedLink = new RegExp("\\[((?!\\]\\(|\\]\\]).)*\\]" + formatToRegex(right), "g");
        let doubleLink = new RegExp(formatToRegex(fileName.replace(/^/, "[[").replace(/\.md$/, "]]")), "g");
        return fileContent.replace(mixedLink, newLink).replace(doubleLink, newLink);
      }
      this.addSettingTab(new MathLinksSettingTab(this.app, this));
    });
  }
  onunload() {
    return __async(this, null, function* () {
      console.log("Unloaded");
    });
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91dGlscy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIE1hcmtkb3duVmlldywgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBNYXRoTGlua3NTZXR0aW5nVGFiIH0gZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBmb3JtYXRUb1JlZ2V4IH0gZnJvbSAnLi91dGlscyc7XG5cbmludGVyZmFjZSBNYXRoTGlua3NTZXR0aW5ncyB7XG4gICAgdGVtcGxhdGVzOiBzdHJpbmdbXTtcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogTWF0aExpbmtzU2V0dGluZ3MgPSB7XG4gICAgdGVtcGxhdGVzOiBbXVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNYXRoTGlua3MgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIHNldHRpbmdzOiBNYXRoTGlua3NTZXR0aW5ncztcblxuICAgIGFzeW5jIG9ubG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzO1xuXG4gICAgICAgIGNvbnN0IHsgdmF1bHQgfSA9IHRoaXMuYXBwO1xuICAgICAgICBjb25zdCB7IHdvcmtzcGFjZSB9ID0gdGhpcy5hcHA7XG4gICAgICAgIGNvbnN0IHsgbWV0YWRhdGFDYWNoZSB9ID0gdGhpcy5hcHA7XG4gICAgICAgIGNvbnN0IHsgZmlsZU1hbmFnZXIgfSA9IHRoaXMuYXBwO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBhbGwgbGlua3MgaW4gYmFja0xpbmtGaWxlcyBpZiBmaWxlICh3aXRoIG1hdGhMaW5rKSBpcyBjaGFuZ2VkLlxuICAgICAgICAvLyAgICAgV2FudCB0byBtb2RpZnkgaXQgc28gaXQgcnVucyBvbmx5IGlmIGEgbWF0aExpbmsgaXMgdXBkYXRlZC9nZW5lcmF0ZWQuXG4gICAgICAgIC8vIEdlbmVyYXRlIG1hdGhMaW5rcyBvZiBvdXRMaW5rcyBpbiBmaWxlIGlmIGZpbGUgIGlzIGNoYW5nZS5cbiAgICAgICAgLy8gICAgIFdhbnQgdG8gbWlkaWZ5IGl0IHNvIGl0IHJ1bnMgb25seSBpZiBhIGxpbmsgaXMgY3JlYXRlZC5cbiAgICAgICAgbWV0YWRhdGFDYWNoZS5vbignY2hhbmdlZCcsIGFzeW5jIChmaWxlOiBURmlsZSwgZGF0YTogc3RyaW5nLCBjYWNoZTogQ2FjaGVkTWV0YURhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGZpbGUubmFtZSk7XG4gICAgICAgICAgICBsZXQgbWF0aExpbmsgPSBhd2FpdCBnZXRNYXRoTGluayhmaWxlKTtcbiAgICAgICAgICAgIGlmIChtYXRoTGluayAhPSBudWxsICYmIG1hdGhMaW5rICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGxldCBiYWNrTGlua0ZpbGVQYXRocyA9IGdldEJhY2tMaW5rRmlsZVBhdGhzKGZpbGUpO1xuICAgICAgICAgICAgICAgIGlmIChiYWNrTGlua0ZpbGVQYXRocy5sZW5ndGggIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBiYWNrTGlua0ZpbGVQYXRocy5mb3JFYWNoKGFzeW5jIChiYWNrTGlua0ZpbGVQYXRoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYmFja0xpbmtGaWxlID0gdmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGJhY2tMaW5rRmlsZVBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhY2tMaW5rRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGJhY2tMaW5rRmlsZUNvbnRlbnQgPSBhd2FpdCB2YXVsdC5yZWFkKGJhY2tMaW5rRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1vZGlmaWVkID0gY29udmVydFRvTWF0aExpbmtzKGZpbGUubmFtZSwgYmFja0xpbmtGaWxlQ29udGVudCwgbWF0aExpbmtbMF0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhY2tMaW5rRmlsZUNvbnRlbnQgIT0gbW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmF1bHQubW9kaWZ5KGJhY2tMaW5rRmlsZSwgbW9kaWZpZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgZmlsZUNvbnRlbnQgPSBhd2FpdCB2YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICAgICAgbGV0IG1vZGlmaWVkID0gZmlsZUNvbnRlbnQ7XG4gICAgICAgICAgICBpZiAoY2FjaGUubGlua3MgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY2FjaGUubGlua3MuZm9yRWFjaChhc3luYyAob3V0TGluaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgb3V0TGlua0ZpbGVOYW1lID0gb3V0TGluay5saW5rO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3V0TGluay5kaXNwbGF5VGV4dCAhPSBcIlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0TGlua0ZpbGVOYW1lID0gb3V0TGlua0ZpbGVOYW1lLnJlcGxhY2UoLyQvLCAnLm1kJyk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBvdXRMaW5rRmlsZVBhdGggPSBmaWxlTWFuYWdlci5nZXROZXdGaWxlUGFyZW50KG91dExpbmtGaWxlTmFtZSkucGF0aCArICcvJyArIG91dExpbmtGaWxlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG91dExpbmtGaWxlID0gdmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKG91dExpbmtGaWxlUGF0aCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dExpbmtGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvdXRMaW5rTWF0aExpbmsgPSBhd2FpdCBnZXRNYXRoTGluayhvdXRMaW5rRmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3V0TGlua01hdGhMaW5rICE9IG51bGwgJiYgb3V0TGlua01hdGhMaW5rICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkID0gY29udmVydFRvTWF0aExpbmtzKG91dExpbmtGaWxlTmFtZSwgbW9kaWZpZWQsIG91dExpbmtNYXRoTGlua1swXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUNvbnRlbnQgIT0gbW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdmF1bHQubW9kaWZ5KGZpbGUsIG1vZGlmaWVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gR2V0IG1hdGhMaW5rIGFzIHN0cmluZyAod2l0aCBsaW5lTnVtYmVyKS4gSWYga2V5IGV4aXN0cyBidXQgbm90IHZhbHVlLCByZXR1cm4gbnVsbCAod2l0aCBsaW5lTnVtYmVyKS4gVW5kZWZpbmVkIG90aGVyd2lzZS5cbiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2V0TWF0aExpbmsoZmlsZTogVEZpbGUpOiBbc3RyaW5nLCBudW1iZXJdIHwgW251bGwsIG51bWJlcl0gfCB1bmRlZmluZWQge1xuICAgICAgICAgICAgbGV0IGNvbnRlbnRzID0gYXdhaXQgdmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICAgIGNvbnRlbnRzID0gY29udGVudHMuc3BsaXQoL1xccj9cXG4vKTtcblxuICAgICAgICAgICAgaWYgKGNvbnRlbnRzWzBdID09PSAnLS0tJykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGxpbmVOdW1iZXIgPSAxOyBsaW5lTnVtYmVyIDwgY29udGVudHMubGVuZ3RoOyBsaW5lTnVtYmVyKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxpbmUgPSBjb250ZW50c1tsaW5lTnVtYmVyXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmUubGVuZ3RoIDwgMTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVOdW1iZXIrKztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBrZXkgPSBsaW5lLnN1YnN0cmluZygwLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnbWF0aExpbms6ICcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBsaW5lLnJlcGxhY2Uoa2V5LCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWF0aExpbmsgPSBhd2FpdCBnZW5lcmF0ZU1hdGhMaW5rRnJvbUF1dG8oZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW21hdGhMaW5rLCBsaW5lTnVtYmVyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3ZhbHVlLCBsaW5lTnVtYmVyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW251bGwsIGxpbmVOdW1iZXJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGluZSA9PT0gJy0tLScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lTnVtYmVyKys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYmFja0xpbmtGaWxlUGF0aHMgb2YgZmlsZVxuICAgICAgICBmdW5jdGlvbiBnZXRCYWNrTGlua0ZpbGVQYXRocyhmaWxlOiBUZmlsZSk6IHN0cmluZ1tdIHtcbiAgICAgICAgICAgIGxldCBiYWNrTGlua0ZpbGVQYXRoczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG1ldGFkYXRhQ2FjaGUucmVzb2x2ZWRMaW5rcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGxpbmtzID0gbWV0YWRhdGFDYWNoZS5yZXNvbHZlZExpbmtzW2tleV07XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobGlua3MpLmZvckVhY2goKGxpbmspID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmsgPT09IGZpbGUucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja0xpbmtGaWxlUGF0aHMucHVzaChrZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGJhY2tMaW5rRmlsZVBhdGhzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgbWF0aExpbmsgZnJvbSAnbWF0aExpbms6IGF1dG8nIGFuZCBmaWxlLm5hbWVcbiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNYXRoTGlua0Zyb21BdXRvKGZpbGU6IFRmaWxlKTogc3RyaW5nIHtcbiAgICAgICAgICAgIGxldCB0ZW1wbGF0ZXMgPSBzZXR0aW5ncy50ZW1wbGF0ZXM7XG4gICAgICAgICAgICBsZXQgYmFzZU5hbWUgPSAgZmlsZS5uYW1lLnJlcGxhY2UoJ1xcLm1kJywgJycpO1xuICAgICAgICAgICAgbGV0IG1hdGhMaW5rID0gYmFzZU5hbWU7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCByZXBsYWNlZCA9IG5ldyBSZWdFeHAoZm9ybWF0VG9SZWdleCh0ZW1wbGF0ZXNbaV0ucmVwbGFjZWQpKTtcbiAgICAgICAgICAgICAgICBsZXQgcmVwbGFjZW1lbnQgPSB0ZW1wbGF0ZXNbaV0ucmVwbGFjZW1lbnQ7XG5cbiAgICAgICAgICAgICAgICBsZXQgZmxhZ3MgPSAnJztcbiAgICAgICAgICAgICAgICBpZiAodGVtcGxhdGVzW2ldLmdsb2JhbE1hdGNoKVxuICAgICAgICAgICAgICAgICAgICBmbGFncyArPSAnZyc7XG4gICAgICAgICAgICAgICAgaWYgKCF0ZW1wbGF0ZXNbaV0uc2Vuc2l0aXZlKVxuICAgICAgICAgICAgICAgICAgICBmbGFncyArPSAnaSc7XG5cbiAgICAgICAgICAgICAgICBpZiAodGVtcGxhdGVzW2ldLndvcmQpXG4gICAgICAgICAgICAgICAgICAgIHJlcGxhY2VkID0gUmVnRXhwKHJlcGxhY2VkLnNvdXJjZS5yZXBsYWNlKC9eLywgJ1xcXFxiJykucmVwbGFjZSgvJC8sICdcXFxcYicpLCBmbGFncyk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICByZXBsYWNlZCA9IFJlZ0V4cChyZXBsYWNlZC5zb3VyY2UsIGZsYWdzKTtcblxuICAgICAgICAgICAgICAgIG1hdGhMaW5rID0gbWF0aExpbmsucmVwbGFjZShyZXBsYWNlZCwgcmVwbGFjZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1hdGhMaW5rO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29udmVydCBtaXhlZCBhbmQgZG91YmxlIGxpbmtzIHRvIG1hdGggbGlua3NcbiAgICAgICAgZnVuY3Rpb24gY29udmVydFRvTWF0aExpbmtzKGZpbGVOYW1lOiBzdHJpbmcsIGZpbGVDb250ZW50OiBzdHJpbmcsIG1hdGhMaW5rOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICAgICAgbGV0IGxlZnQgPSBtYXRoTGluay5yZXBsYWNlKC9eLywgJ1snKS5yZXBsYWNlKC8kLywgJ10nKTtcbiAgICAgICAgICAgIGxldCByaWdodCA9IGZpbGVOYW1lLnJlcGxhY2UoL14vLCAnKCcpLnJlcGxhY2UoLyQvLCAnKScpLnJlcGxhY2UoL1xccy9nLCAnJTIwJyk7XG4gICAgICAgICAgICBsZXQgbmV3TGluayA9IGAke2xlZnR9JHtyaWdodH1gO1xuXG4gICAgICAgICAgICBsZXQgbWl4ZWRMaW5rID0gbmV3IFJlZ0V4cCgnXFxcXFsoKD8hXFxcXF1cXFxcKHxcXFxcXVxcXFxdKS4pKlxcXFxdJyArIGZvcm1hdFRvUmVnZXgocmlnaHQpLCAnZycpO1xuICAgICAgICAgICAgbGV0IGRvdWJsZUxpbmsgPSBuZXcgUmVnRXhwKGZvcm1hdFRvUmVnZXgoZmlsZU5hbWUucmVwbGFjZSgvXi8sICdcXFtcXFsnKS5yZXBsYWNlKC9cXC5tZCQvLCAnXFxdXFxdJykpLCAnZycpO1xuXG4gICAgICAgICAgICByZXR1cm4gZmlsZUNvbnRlbnQucmVwbGFjZShtaXhlZExpbmssIG5ld0xpbmspLnJlcGxhY2UoZG91YmxlTGluaywgbmV3TGluayk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgTWF0aExpbmtzU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICAgIH1cblxuICAgIGFzeW5jIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnVW5sb2FkZWQnKTtcbiAgICB9XG5cbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgU2V0dGluZywgUGx1Z2luU2V0dGluZ1RhYiwgTW9kYWwsIFRleHRDb21wb25lbnQsIERyb3Bkb3duQ29tcG9uZW50LCBOb3RpY2UgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBmb3JtYXRUb1JlZ2V4IH0gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBjbGFzcyBNYXRoTGlua3NTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBNYXRoTGlua3M7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBhc3luYyBkaXNwbGF5KCk6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHt0ZXh0OiAnTWF0aExpbmtzIFNldHRpbmdzJ30pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0FkZCBhIG5ldyB0ZW1wbGF0ZScpXG4gICAgICAgICAgICAuc2V0RGVzYyhcbiAgICAgICAgICAgICAgICBjcmVhdGVGcmFnbWVudCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0F1dG9tYXRpY2FsbHkgZ2VuZXJhdGUgYSBtYXRoTGluayB3aXRoIHRlbXBsYXRlcy4gVXNlICdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoJ2NvZGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnbWF0aExpbms6IGF1dG8nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJyB0byB1c2UgdGVtcGxhdGVzIGluIGEgZmlsZS4nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidXR0b246IEJ1dHRvbkNvbXBvbmVudCk6IEJ1dHRvbkNvbXBvbmVudCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGIgPSBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgLnNldFRvb2x0aXAoXCJBZGRcIilcbiAgICAgICAgICAgICAgICAgICAgLnNldEljb24oXCJwbHVzXCIpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbCA9IG5ldyBBZGRUZW1wbGF0ZXNNb2RhbCh0aGlzLmFwcCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9uQ2xvc2UgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGFsLnNhdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG1vZGFsLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZWQ6IG1vZGFsLnJlcGxhY2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnQ6IG1vZGFsLnJlcGxhY2VtZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsTWF0Y2g6IG1vZGFsLmdsb2JhbE1hdGNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vuc2l0aXZlOiBtb2RhbC5zZW5zaXRpdmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkOiBtb2RhbC53b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzLnB1c2godGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnTWF0aExpbmtzOiBUZW1wbGF0ZSBhZGRlZC4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgdGVtcGxhdGVUaXRsZVRvRWRpdDogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnRWRpdCB0ZW1wbGF0ZScpXG4gICAgICAgICAgICAuc2V0RGVzYygnU2VsZWN0IGEgdGVtcGxhdGUgdG8gZWRpdCBpdC4nKVxuICAgICAgICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bjogRHJvcGRvd25Db21wb25lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJfX3NlbGVjdFwiLCBcIlNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24odGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldLnRpdGxlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXNbaV0udGl0bGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkcm9wZG93bi5vbkNoYW5nZShhc3luYyAoY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudCAhPSAnX19zZWxlY3QnKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVUaXRsZVRvRWRpdCA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVGl0bGVUb0VkaXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uOiBCdXR0b25Db21wb25lbnQpOiBCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBiID0gYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIC5zZXRUb29sdGlwKFwiRWRpdFwiKVxuICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbihcImVkaXRcIilcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBsYXRlVGl0bGVUb0VkaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgb3JpZ2luYWxUZW1wbGF0ZXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbCA9IG5ldyBFZGl0VGVtcGxhdGVzTW9kYWwodGhpcy5hcHAsIHRlbXBsYXRlVGl0bGVUb0VkaXQsIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5vbkNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kYWwuc2F2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnTWF0aExpbmtzOiBUZW1wbGF0ZSBzYXZlZC4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcyA9IG9yaWdpbmFsVGVtcGxhdGVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnTWF0aExpbmtzOiBQbGVhc2Ugc2VsZWN0IGEgdGVtcGxhdGUuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBiO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHRlbXBsYXRlVGl0bGVUb0RlbGV0ZTogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnRGVsZXRlIGEgdGVtcGxhdGUnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1NlbGVjdCBhIHRlbXBsYXRlIHRvIGRlbGV0ZSBpdC4nKVxuICAgICAgICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bjogRHJvcGRvd25Db21wb25lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJfX3NlbGVjdFwiLCBcIlNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24odGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldLnRpdGxlLCB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXNbaV0udGl0bGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkcm9wZG93bi5vbkNoYW5nZShhc3luYyAoY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudCAhPSAnX19zZWxlY3QnKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVUaXRsZVRvRGVsZXRlID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVUaXRsZVRvRGVsZXRlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbjogQnV0dG9uQ29tcG9uZW50KTogQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgYiA9IGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAuc2V0VG9vbHRpcChcIkRlbGV0ZVwiKVxuICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbihcInRyYXNoXCIpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZVRpdGxlVG9EZWxldGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbW9kYWwgPSBuZXcgRGVsZXRlVGVtcGxhdGVzTW9kYWwodGhpcy5hcHAsIHRlbXBsYXRlVGl0bGVUb0RlbGV0ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5vbkNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kYWwucHJvY2VlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldLnRpdGxlID09PSB0ZW1wbGF0ZVRpdGxlVG9EZWxldGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYE1hdGhMaW5rczogVGVtcGxhdGUgJyR7dGVtcGxhdGVUaXRsZVRvRGVsZXRlfScgZGVsZXRlZC5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnTWF0aExpbmtzOiBQbGVhc2Ugc2VsZWN0IGEgdGVtcGxhdGUuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBiO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxufVxuXG5jbGFzcyBBZGRUZW1wbGF0ZXNNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBzYXZlZDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHRpdGxlOiBzdHJpbmcgPSAnJztcblxuICAgIHJlcGxhY2VkOiBzdHJpbmcgPSAnJztcbiAgICByZXBsYWNlbWVudDogc3RyaW5nID0gJyc7XG5cbiAgICBnbG9iYWxNYXRjaDogYm9vbGVhbiA9IHRydWU7XG4gICAgc2Vuc2l0aXZlOiBib29sZWFuID0gdHJ1ZTtcbiAgICB3b3JkOiBib29sZWFuID0gdHJ1ZVxuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHApIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXG4gICAgICAgIGxldCB0aXRsZVRleHQ6IFRleHRDb21wb25lbnQ7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdUaXRsZScpXG4gICAgICAgICAgICAuc2V0RGVzYygnTmFtZSBvZiB0aGUgdGVtcGxhdGUuJylcbiAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGl0bGVUZXh0ID0gdGV4dDtcbiAgICAgICAgICAgICAgICB0aXRsZVRleHQuc2V0VmFsdWUodGhpcy50aXRsZSkub25DaGFuZ2UoKGN1cnJlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgcmVwbGFjZWRUZXh0OiBUZXh0Q29tcG9uZW50O1xuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnUmVwbGFjZSBhbGwgLi4uJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTdHJpbmdzIHRvIGJlIG1hdGNoZWQgYW5kIHJlcGxhY2VkLicpXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlcGxhY2VkVGV4dCA9IHRleHQ7XG4gICAgICAgICAgICAgICAgcmVwbGFjZWRUZXh0LnNldFZhbHVlKHRoaXMucmVwbGFjZWQpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZWQgPSBmb3JtYXRUb1JlZ2V4KGN1cnJlbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHJlcGxhY2VtZW50VGV4dDogVGV4dENvbXBvbmVudDtcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJy4uLiB3aXRoJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTdHJpbmcgdG8gcmVwbGFjZSBhbGwgbWF0Y2hlcy4gRG8gbm90IGVzY2FwZSBiYWNrc2xhc2hlcy4nKVxuICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICByZXBsYWNlbWVudFRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50VGV4dC5zZXRWYWx1ZSh0aGlzLnJlcGxhY2VtZW50KS5vbkNoYW5nZSgoY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VtZW50ID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdHbG9iYWwnKVxuICAgICAgICAgICAgLnNldERlc2MoJ01hdGNoIGFsbCBpbnN0YW5jZXMgKGluc3RlYWQgb2YganVzdCB0aGUgZmlyc3QpLicpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodHJ1ZSkub25DaGFuZ2UoKGN1cnJlbnQpID0+ICh0aGlzLmdsb2JhbE1hdGNoID0gY3VycmVudCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0Nhc2Ugc2Vuc2l0aXZlJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdNYXRjaGVzIHdpbGwgYmUgY2FzZSBzZW5zaXRpdmUuJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0cnVlKS5vbkNoYW5nZSgoY3VycmVudCkgPT4gKHRoaXMuc2Vuc2l0aXZlID0gY3VycmVudCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1dob2xlIHdvcmQnKVxuICAgICAgICAgICAgLnNldERlc2MoJ09ubHkgbWF0Y2ggd2hvbGUgd29yZHMuJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0cnVlKS5vbkNoYW5nZSgoY3VycmVudCkgPT4gKHRoaXMud29yZCA9IGN1cnJlbnQpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBmb290ZXJFbCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcbiAgICAgICAgbGV0IGZvb3RlckJ1dHRvbnMgPSBuZXcgU2V0dGluZyhmb290ZXJFbCk7XG4gICAgICAgIGZvb3RlckJ1dHRvbnMuYWRkQnV0dG9uKChiKSA9PiB7XG4gICAgICAgICAgICBiLnNldFRvb2x0aXAoXCJTYXZlXCIpXG4gICAgICAgICAgICAgICAgLnNldEljb24oXCJjaGVja21hcmtcIilcbiAgICAgICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYjtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvb3RlckJ1dHRvbnMuYWRkRXh0cmFCdXR0b24oKGIpID0+IHtcbiAgICAgICAgICAgIGIuc2V0VG9vbHRpcChcIkNhbmNlbFwiKVxuICAgICAgICAgICAgICAgIC5zZXRJY29uKFwiY3Jvc3NcIilcbiAgICAgICAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuY2xhc3MgRWRpdFRlbXBsYXRlc01vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIHNhdmVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgdGVtcGxhdGVUaXRsZTogc3RyaW5nO1xuICAgIHRlbXBsYXRlczogc3RyaW5nW107XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgdGVtcGxhdGVUaXRsZTogc3RyaW5nLCB0ZW1wbGF0ZXM6IHN0cmluZ1tdKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMudGVtcGxhdGVUaXRsZSA9IHRlbXBsYXRlVGl0bGU7XG4gICAgICAgIHRoaXMudGVtcGxhdGVzID0gdGVtcGxhdGVzO1xuICAgIH1cblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG5cbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMudGVtcGxhdGVUaXRsZSAhPSB1bmRlZmluZWQgJiYgdGhpcy50ZW1wbGF0ZXNbaV0udGl0bGUgPT09IHRoaXMudGVtcGxhdGVUaXRsZSkge1xuICAgICAgICAgICAgICAgIGxldCB0aXRsZVRleHQ6IFRleHRDb21wb25lbnQ7XG4gICAgICAgICAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TmFtZSgnVGl0bGUnKVxuICAgICAgICAgICAgICAgICAgICAuc2V0RGVzYygnTmFtZSBvZiB0aGUgdGVtcGxhdGUuJylcbiAgICAgICAgICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlVGV4dCA9IHRleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVRleHQuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZXNbaV0udGl0bGUpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZXNbaV0udGl0bGUgPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbGV0IHJlcGxhY2VkVGV4dDogVGV4dENvbXBvbmVudDtcbiAgICAgICAgICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAgICAgICAgIC5zZXROYW1lKCdSZXBsYWNlIGFsbCAuLi4nKVxuICAgICAgICAgICAgICAgICAgICAuc2V0RGVzYygnU3RyaW5ncyB0byBiZSBtYXRjaGVkIGFuZCByZXBsYWNlZC4nKVxuICAgICAgICAgICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZWRUZXh0ID0gdGV4dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VkVGV4dC5zZXRWYWx1ZSh0aGlzLnRlbXBsYXRlc1tpXS5yZXBsYWNlZCkub25DaGFuZ2UoKGN1cnJlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlc1tpXS5yZXBsYWNlZCA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgcmVwbGFjZW1lbnRUZXh0OiBUZXh0Q29tcG9uZW50O1xuICAgICAgICAgICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgICAgICAgICAgLnNldE5hbWUoJy4uLiB3aXRoJylcbiAgICAgICAgICAgICAgICAgICAgLnNldERlc2MoJ1N0cmluZyB0byByZXBsYWNlIGFsbCBtYXRjaGVzLiBEbyBub3QgZXNjYXBlIGJhY2tzbGFzaGVzLicpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlbWVudFRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnRUZXh0LnNldFZhbHVlKHRoaXMudGVtcGxhdGVzW2ldLnJlcGxhY2VtZW50KS5vbkNoYW5nZSgoY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcGxhdGVzW2ldLnJlcGxhY2VtZW50ID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgICAgICAgICAgLnNldE5hbWUoJ0dsb2JhbCcpXG4gICAgICAgICAgICAgICAgICAgIC5zZXREZXNjKCdNYXRjaCBhbGwgaW5zdGFuY2VzIChpbnN0ZWFkIG9mIGp1c3QgdGhlIGZpcnN0KScpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMudGVtcGxhdGVzW2ldLmdsb2JhbE1hdGNoKS5vbkNoYW5nZSgoY3VycmVudCkgPT4gKHRoaXMudGVtcGxhdGVzW2ldLmdsb2JhbE1hdGNoID0gY3VycmVudCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgICAgICAgICAgLnNldE5hbWUoJ0Nhc2Ugc2Vuc2l0aXZlJylcbiAgICAgICAgICAgICAgICAgICAgLnNldERlc2MoJ01hdGNoZXMgd2lsbCBiZSBjYXNlIHNlbnNpdGl2ZS4nKVxuICAgICAgICAgICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnRlbXBsYXRlc1tpXS5zZW5zaXRpdmUpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiAodGhpcy50ZW1wbGF0ZXNbaV0uc2Vuc2l0aXZlID0gY3VycmVudCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgICAgICAgICAgLnNldE5hbWUoJ1dob2xlIHdvcmQnKVxuICAgICAgICAgICAgICAgICAgICAuc2V0RGVzYygnT25seSBtYXRjaCB3aG9sZSB3b3Jkcy4nKVxuICAgICAgICAgICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnRlbXBsYXRlc1tpXS5zZW5zaXRpdmUpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiAodGhpcy50ZW1wbGF0ZXNbaV0ud29yZCA9IGN1cnJlbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmb290ZXJFbCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcbiAgICAgICAgbGV0IGZvb3RlckJ1dHRvbnMgPSBuZXcgU2V0dGluZyhmb290ZXJFbCk7XG4gICAgICAgIGZvb3RlckJ1dHRvbnMuYWRkQnV0dG9uKChiKSA9PiB7XG4gICAgICAgICAgICBiLnNldFRvb2x0aXAoXCJTYXZlXCIpXG4gICAgICAgICAgICAgICAgLnNldEljb24oXCJjaGVja21hcmtcIilcbiAgICAgICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYjtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvb3RlckJ1dHRvbnMuYWRkRXh0cmFCdXR0b24oKGIpID0+IHtcbiAgICAgICAgICAgIGIuc2V0VG9vbHRpcChcIkNhbmNlbFwiKVxuICAgICAgICAgICAgICAgIC5zZXRJY29uKFwiY3Jvc3NcIilcbiAgICAgICAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuY2xhc3MgRGVsZXRlVGVtcGxhdGVzTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gICAgcHJvY2VlZDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHRlbXBsYXRlVGl0bGU6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCB0ZW1wbGF0ZVRpdGxlOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZVRpdGxlID0gdGVtcGxhdGVUaXRsZTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gzJywge3RleHQ6IGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICcke3RoaXMudGVtcGxhdGVUaXRsZX0nP2B9KTtcblxuICAgICAgICBsZXQgZm9vdGVyRWwgPSBjb250ZW50RWwuY3JlYXRlRGl2KCk7XG4gICAgICAgIGxldCBmb290ZXJCdXR0b25zID0gbmV3IFNldHRpbmcoZm9vdGVyRWwpO1xuICAgICAgICBmb290ZXJCdXR0b25zLmFkZEJ1dHRvbigoYikgPT4ge1xuICAgICAgICAgICAgYi5zZXRUb29sdGlwKFwiWWVzXCIpXG4gICAgICAgICAgICAgICAgLnNldEljb24oXCJjaGVja21hcmtcIilcbiAgICAgICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2VlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBiO1xuICAgICAgICB9KTtcbiAgICAgICAgZm9vdGVyQnV0dG9ucy5hZGRFeHRyYUJ1dHRvbigoYikgPT4ge1xuICAgICAgICAgICAgYi5zZXRUb29sdGlwKFwiQ2FuY2VsXCIpXG4gICAgICAgICAgICAgICAgLnNldEljb24oXCJjcm9zc1wiKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZWVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBiO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCAiZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFRvUmVnZXgoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBzdHJcbiAgICAgICAgLnJlcGxhY2UoL1xccy9nLCAnXFxcXHMnKVxuICAgICAgICAucmVwbGFjZSgvXFwuL2csICdcXFxcLicpXG4gICAgICAgIC5yZXBsYWNlKC9cXCgvZywgJ1xcXFwoJylcbiAgICAgICAgLnJlcGxhY2UoL1xcKS9nLCAnXFxcXCknKVxuICAgICAgICAucmVwbGFjZSgvXFx7L2csICdcXFxceycpXG4gICAgICAgIC5yZXBsYWNlKC9cXH0vZywgJ1xcXFx9JylcbiAgICAgICAgLnJlcGxhY2UoL1xcWy9nLCAnXFxcXFsnKVxuICAgICAgICAucmVwbGFjZSgvXFxdL2csICdcXFxcXScpO1xufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQWlEOzs7QUNBakQsc0JBQTJGOzs7QUNBcEYsdUJBQXVCLEtBQXFCO0FBQy9DLFNBQU8sSUFDRixRQUFRLE9BQU8sS0FBSyxFQUNwQixRQUFRLE9BQU8sS0FBSyxFQUNwQixRQUFRLE9BQU8sS0FBSyxFQUNwQixRQUFRLE9BQU8sS0FBSyxFQUNwQixRQUFRLE9BQU8sS0FBSyxFQUNwQixRQUFRLE9BQU8sS0FBSyxFQUNwQixRQUFRLE9BQU8sS0FBSyxFQUNwQixRQUFRLE9BQU8sS0FBSztBQUM3Qjs7O0FEUE8sSUFBTSxzQkFBTixjQUFrQyxpQ0FBaUI7QUFBQSxFQUd0RCxZQUFZLEtBQVUsUUFBbUI7QUFDckMsVUFBTSxLQUFLLE1BQU07QUFDakIsU0FBSyxTQUFTO0FBQUEsRUFDbEI7QUFBQSxF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QUFJLFVBQVUsUUFBUSxLQUFLO0FBQ3ZDLGdCQUFJLFdBQVcsSUFBSSxPQUFPLGNBQWMsVUFBVSxHQUFHLFFBQVEsQ0FBQztBQUM5RCxnQkFBSSxjQUFjLFVBQVUsR0FBRztBQUUvQixnQkFBSSxRQUFRO0FBQ1osZ0JBQUksVUFBVSxHQUFHO0FBQ2IsdUJBQVM7QUFDYixnQkFBSSxDQUFDLFVBQVUsR0FBRztBQUNkLHVCQUFTO0FBRWIsZ0JBQUksVUFBVSxHQUFHO0FBQ2IseUJBQVcsT0FBTyxTQUFTLE9BQU8sUUFBUSxLQUFLLEtBQUssRUFBRSxRQUFRLEtBQUssS0FBSyxHQUFHLEtBQUs7QUFBQTtBQUVoRix5QkFBVyxPQUFPLFNBQVMsUUFBUSxLQUFLO0FBRTVDLHVCQUFXLFNBQVMsUUFBUSxVQUFVLFdBQVc7QUFBQSxVQUNyRDtBQUNBLGlCQUFPO0FBQUEsUUFDWDtBQUFBO0FBR0Esa0NBQTRCLFVBQWtCLGFBQXFCLFVBQTBCO0FBQ3pGLFlBQUksT0FBTyxTQUFTLFFBQVEsS0FBSyxHQUFHLEVBQUUsUUFBUSxLQUFLLEdBQUc7QUFDdEQsWUFBSSxRQUFRLFNBQVMsUUFBUSxLQUFLLEdBQUcsRUFBRSxRQUFRLEtBQUssR0FBRyxFQUFFLFFBQVEsT0FBTyxLQUFLO0FBQzdFLFlBQUksVUFBVSxHQUFHLE9BQU87QUFFeEIsWUFBSSxZQUFZLElBQUksT0FBTyxnQ0FBZ0MsY0FBYyxLQUFLLEdBQUcsR0FBRztBQUNwRixZQUFJLGFBQWEsSUFBSSxPQUFPLGNBQWMsU0FBUyxRQUFRLEtBQUssSUFBTSxFQUFFLFFBQVEsU0FBUyxJQUFNLENBQUMsR0FBRyxHQUFHO0FBRXRHLGVBQU8sWUFBWSxRQUFRLFdBQVcsT0FBTyxFQUFFLFFBQVEsWUFBWSxPQUFPO0FBQUEsTUFDOUU7QUFHQSxXQUFLLGNBQWMsSUFBSSxvQkFBb0IsS0FBSyxLQUFLLElBQUksQ0FBQztBQUFBLElBQzlEO0FBQUE7QUFBQSxFQUVBLEFBQU0sV0FBVztBQUFBO0FBQ2IsY0FBUSxJQUFJLFVBQVU7QUFBQSxJQUMxQjtBQUFBO0FBQUEsRUFFQSxBQUFNLGVBQWU7QUFBQTtBQUNqQixXQUFLLFdBQVcsT0FBTyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsTUFBTSxLQUFLLFNBQVMsQ0FBQztBQUFBLElBQzdFO0FBQUE7QUFBQSxFQUVBLEFBQU0sZUFBZTtBQUFBO0FBQ2pCLFlBQU0sS0FBSyxTQUFTLEtBQUssUUFBUTtBQUFBLElBQ3JDO0FBQUE7QUFDSjsiLAogICJuYW1lcyI6IFtdCn0K
